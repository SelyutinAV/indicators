# Система управления показателями и дашбордами

Прототип системы для управления показателями (атомарными и агрегатными) с возможностью генерации тестовых данных и построения дашбордов.

## Возможности

- **Управление показателями**
  - Создание атомарных и агрегатных показателей
  - Описание показателей
  - Указание единиц измерения (справочник)
  - Генерация тестовых значений с указанием диапазона и дат

- **Агрегатные показатели**
  - Конструктор формул для расчета из других показателей
  - Поддержка смешанных формул (атомарные + агрегатные показатели)
  - Валидация формул на циклические зависимости

- **Административный интерфейс**
  - Удобный Django Admin для управления всеми сущностями
  - Просмотр значений показателей
  - Генерация тестовых данных прямо из админки

## Установка

1. Создайте виртуальное окружение (если еще не создано):
```bash
python3 -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Выполните миграции:
```bash
python manage.py makemigrations
python manage.py migrate
```

4. Создайте суперпользователя:
```bash
python manage.py createsuperuser
```

5. Запустите сервер:

**Вариант A: Через Cursor/VSCode (рекомендуется)**
- Нажмите `Cmd+Shift+P` (macOS) или `Ctrl+Shift+P` (Windows/Linux)
- Введите "Tasks: Run Task" → выберите "Запустить Django сервер"
- Или нажмите `F5` и выберите конфигурацию "Django: запустить сервер"

**Вариант B: Через командную строку**
```bash
python run_server.py
# или
python manage.py runserver
```

> **Примечание:** Скрипт `run_server.py` автоматически проверяет занятость порта и перезапускает сервер при необходимости.

6. Откройте браузер и перейдите на http://127.0.0.1:8000/admin/

## Использование

### Создание единиц измерения

1. Перейдите в раздел "Единицы измерения"
2. Создайте новую единицу (например: "Рубли", "Штуки", "Проценты")

### Создание атомарного показателя

1. Перейдите в раздел "Показатели"
2. Нажмите "Добавить показатель"
3. Заполните:
   - Название
   - Описание
   - Тип: Атомарный
   - Единица измерения
   - Минимальное и максимальное значение (для генерации данных)
4. Сохраните

### Генерация тестовых данных

1. Откройте карточку показателя
2. В форме есть поля:
   - Начальная дата для генерации
   - Конечная дата для генерации
   - Чекбокс "Сгенерировать тестовые данные"
3. Заполните даты, отметьте чекбокс и сохраните
4. Данные будут созданы автоматически

### Создание агрегатного показателя

1. Создайте показатель с типом "Агрегатный"
2. В поле "Формула" укажите формулу, используя названия показателей в квадратных скобках:
   - `[Показатель1] + [Показатель2]`
   - `[Показатель1] * 100 / [Показатель2]`
   - `([Показатель1] + [Показатель2]) / 2`
3. Система автоматически проверит формулу на валидность и циклические зависимости

### Просмотр значений

Значения показателей можно просмотреть:
- В карточке показателя (внизу страницы)
- В разделе "Значения показателей"

## Структура проекта

```
models/
├── indicators/              # Приложение показателей
│   ├── models.py           # Модели: Unit, Indicator, IndicatorValue
│   ├── admin.py            # Настройка Django Admin
│   ├── generators.py       # Генерация тестовых данных
│   └── formula_parser.py   # Парсер и валидатор формул
├── indicators_project/     # Настройки проекта
├── .vscode/                # Настройки для Cursor/VSCode
│   ├── tasks.json          # Задачи для запуска
│   ├── launch.json         # Конфигурации отладки
│   └── settings.json       # Настройки Python
├── manage.py
├── run_server.py           # Скрипт запуска с проверкой порта
├── requirements.txt
└── README.md
```

## Модели данных

- **Unit** - Единица измерения
- **Indicator** - Показатель (атомарный или агрегатный)
- **IndicatorValue** - Значение показателя на определенную дату

## Дальнейшее развитие

Возможные улучшения:
- Визуализация данных (графики)
- Дашборды с несколькими показателями
- Импорт данных из файлов
- Категории и теги для показателей
- История изменений
- API для интеграции с внешними системами
